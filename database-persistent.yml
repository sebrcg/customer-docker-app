  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: database-persistent
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: database-persistent
    template:
      metadata:
        labels:
          app: database-persistent
      spec:
        containers:
        - name: mysql
          image: mysql:8.0
          env:
          - name: MYSQL_ROOT_PASSWORD
            valueFrom:
              secretKeyRef:
                name: mysql-secret
                key: root-password
          - name: MYSQL_DATABASE
            value: webapp
          ports:
          - containerPort: 3306
          livenessProbe:
            exec:
              command:
              - mysqladmin
              - ping
              - -h
              - localhost
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
          volumeMounts:
          - name: mysql-storage
            mountPath: /var/lib/mysql
        volumes:
        - name: mysql-storage
          persistentVolumeClaim:
            claimName: mysql-pvc
